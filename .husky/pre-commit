#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Validando c√≥digo..."

# Valida JS e PHP
npx lint-staged

# Valida URLs hardcoded em PHP
echo "üîç Verificando URLs hardcoded em PHP..."
LOCALHOST_FILES=$(git diff --cached --name-only | grep '\.php$' | xargs grep -l 'localhost\|127\.0\.0\.1' 2>/dev/null || true)

if [ -n "$LOCALHOST_FILES" ]; then
    echo "‚ùå ERRO: Encontrado 'localhost' ou '127.0.0.1' nos seguintes arquivos:"
    echo "$LOCALHOST_FILES" | while read file; do
        echo "  - $file"
        grep -n 'localhost\|127\.0\.0\.1' "$file" | head -3
    done
    echo ""
    echo "üí° Use base_url() ou site_url() do CodeIgniter em vez de URLs hardcoded."
    exit 1
fi

echo "‚úÖ Valida√ß√£o conclu√≠da!"
